{{include  file="$smarty_root/header.html" }}

                <!-- content -->
                <div class="col-md-10">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="page-header bootstrap-admin-content-title">
                                <h1>{{$SysLang.validate.batchvalidation}}</h1>
                                <a href="{{$uploadpath}}/validation_excel/Example.xls" class="action">
                                    <button class="btn btn-success"><i class="glyphicon glyphicon-download-alt"></i> {{$SysLang.validate.downloadexample}}</button>
                                </a>
                                <a href="#" id="btnupload" class="action">
                                    <button class="btn btn-success"><i class="glyphicon glyphicon-upload"></i> {{$SysLang.validate.upload}}</button>
                                </a>
                                <input style="display:none;" name="validation_excel" id="validation_excel" onchange="afterupload('{{$filemodule}}', 'validation_excel')" type="file" />
                            </div>
                        </div>
                    </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="text-muted bootstrap-admin-box-title">{{$SysLang.validate.confirmcontent}}</div>
                                    </div>
                                    <div class="bootstrap-admin-panel-content">
                                        <div class="row form-horizontal">
                                            <table class="table table-striped" id="validated_data">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>验证码</th>
                                                        <th>预约时间</th>
                                                        <th>疫苗</th>
                                                        <th>客户名称</th>
                                                        <th>客户电话</th>
                                                        <th>状态</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                        <hr />
                                        <div class="text-center">
                                            <button class="btn btn-success" id="btnApprove"><i class="glyphicon glyphicon-saved  glyphicon-white"></i> {{$SysLang.validate.approve}}</button>
                                            <input id="nowfilename" value="" type="hidden" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
<script>
    $(document).ready(function () {
        $("#btnupload").click(function () {
            $("#validation_excel").click();
        });
        $("#btnApprove").click(function () {
            var str = "0";
            $("#validated_data .waitforapprove").each(function () {
                str += "," + $(this).val();
            });

            if (str == "0") {
                warningDialog("{{$SysLang.validate.pleaseuploadfirst}}");
                return;
            }

            var json = {
                "action": "approve",
                "val":str
            };

            $.post("{{$rootpath}}/Appointment/batchvalidation.php", json, function (data) {
                if (data == "SUCCESS") {
                    infoDialog("{{$SysLang.model.savesuccess}}");

                    LoadUploadResult();
                } else {
                    errorDialog(data);
                }
            });

        });
    });
    function afterupload(key, module) {

        $.ajaxFileUpload
		(
			{
			    "url": '{{$rootpath}}/fileupload.php?module=' + module + "&field=" + key,
			    "secureuri": false,
			    "fileElementId": "" + key,
			    "dataType": 'text',
			    "success": function (data, status) {
			        //alert(data);
			        if (data.substring(0, 7) == "success") {
			            str = data.substring(7, data.length);
			            $("#nowfilename").val(str.split('|~~|')[1]);
			            LoadUploadResult();
                        
			        } else {
			            errorDialog("{{$SysLang.model.uploaderror}}");
			        }
			    },
			    "error": function (data, status, e) {
			        errorDialog("{{$SysLang.model.uploaderror}}");
			    }
			}
		);
    }
    function LoadUploadResult() {
        var json = {
            "action": "upload",
            "filename": str.split('|~~|')[1]
        };
        $("#validated_data").load("{{$rootpath}}/Appointment/batchvalidation.php", json, function (data) {
            //alert(data);
        });
    }
</script>

 {{include  file="$smarty_root/footer.html" }}